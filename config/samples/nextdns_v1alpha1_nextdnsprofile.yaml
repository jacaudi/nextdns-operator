apiVersion: nextdns.io/v1alpha1
kind: NextDNSProfile
metadata:
  name: corporate-dns
  namespace: default
spec:
  name: "Corporate DNS Policy"

  # Reference to Secret containing NextDNS API key
  credentialsRef:
    name: nextdns-credentials
    key: api-key

  # Reference shared lists
  allowlistRefs:
    - name: corporate-allowlist

  denylistRefs:
    - name: security-denylist

  tldListRefs:
    - name: high-risk-tlds

  # Inline entries (profile-specific)
  allowlist:
    - domain: "internal.mycompany.com"
      reason: "Internal portal"

  # Security settings
  security:
    aiThreatDetection: true
    googleSafeBrowsing: true
    cryptojacking: true
    dnsRebinding: true
    idnHomographs: true
    typosquatting: true
    dga: true
    nrd: false
    ddns: false
    parking: true
    csam: true

  # Privacy settings
  privacy:
    blocklists:
      - id: nextdns-recommended
      - id: oisd
    disguisedTrackers: true
    allowAffiliate: false

  # General settings
  settings:
    logs:
      enabled: true
      retention: "30d"
    blockPage:
      enabled: true
    performance:
      ecs: true
      cacheBoost: true
      cnameFlattening: true

  # Optional: Import base configuration from a ConfigMap containing JSON
  # Explicit spec fields above take precedence over imported values
  # configImportRef:
  #   name: my-profile-config
  #   key: profile.json  # defaults to "config.json"

  # Optional: Create ConfigMap with DNS connection details
  # Useful for configuring DNS clients or injecting into pods
  configMapRef:
    enabled: true
    # name: custom-config-name  # defaults to "<profile-name>-nextdns"
