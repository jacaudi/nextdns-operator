---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: nextdnsprofiles.nextdns.io
spec:
  group: nextdns.io
  names:
    kind: NextDNSProfile
    listKind: NextDNSProfileList
    plural: nextdnsprofiles
    singular: nextdnsprofile
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.profileID
      name: Profile ID
      type: string
    - jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: NextDNSProfile is the Schema for the nextdnsprofiles API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: NextDNSProfileSpec defines the desired state of NextDNSProfile
            properties:
              allowlist:
                description: Allowlist specifies inline domains to allow (merged with
                  AllowlistRefs)
                items:
                  description: DomainEntry represents a domain in allow/deny lists
                  properties:
                    active:
                      default: true
                      description: Active indicates if this entry is enabled
                      type: boolean
                    domain:
                      description: Domain is the domain name (supports wildcards like
                        *.example.com)
                      maxLength: 253
                      minLength: 1
                      pattern: ^(\*\.)?([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$
                      type: string
                    reason:
                      description: Reason documents why this domain is in the list
                      type: string
                  required:
                  - domain
                  type: object
                type: array
              allowlistRefs:
                description: |-
                  AllowlistRefs references NextDNSAllowlist resources
                  Domains from all referenced allowlists are merged
                items:
                  description: ListReference references a list CRD (allowlist, denylist,
                    or TLD list)
                  properties:
                    name:
                      description: Name of the list resource
                      type: string
                    namespace:
                      description: Namespace of the list resource (defaults to profile's
                        namespace)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              configImportRef:
                description: |-
                  ConfigImportRef references a ConfigMap containing profile configuration JSON
                  Fields from the ConfigMap are applied as defaults; explicit spec fields take precedence
                properties:
                  key:
                    default: config.json
                    description: Key is the key within the ConfigMap data containing
                      the JSON
                    type: string
                  name:
                    description: Name is the name of the ConfigMap to import from
                    minLength: 1
                    type: string
                required:
                - name
                type: object
              configMapRef:
                description: ConfigMapRef configures optional ConfigMap creation with
                  connection details
                properties:
                  enabled:
                    default: false
                    description: Enabled enables creation of the ConfigMap
                    type: boolean
                  name:
                    description: |-
                      Name is the name of the ConfigMap to create
                      If not specified, defaults to "<profile-name>-nextdns"
                    type: string
                type: object
              credentialsRef:
                description: CredentialsRef references a Secret containing the NextDNS
                  API key
                properties:
                  key:
                    default: api-key
                    description: Key is the key within the Secret
                    type: string
                  name:
                    description: Name is the name of the Secret
                    type: string
                required:
                - name
                type: object
              denylist:
                description: Denylist specifies inline domains to block (merged with
                  DenylistRefs)
                items:
                  description: DomainEntry represents a domain in allow/deny lists
                  properties:
                    active:
                      default: true
                      description: Active indicates if this entry is enabled
                      type: boolean
                    domain:
                      description: Domain is the domain name (supports wildcards like
                        *.example.com)
                      maxLength: 253
                      minLength: 1
                      pattern: ^(\*\.)?([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$
                      type: string
                    reason:
                      description: Reason documents why this domain is in the list
                      type: string
                  required:
                  - domain
                  type: object
                type: array
              denylistRefs:
                description: |-
                  DenylistRefs references NextDNSDenylist resources
                  Domains from all referenced denylists are merged
                items:
                  description: ListReference references a list CRD (allowlist, denylist,
                    or TLD list)
                  properties:
                    name:
                      description: Name of the list resource
                      type: string
                    namespace:
                      description: Namespace of the list resource (defaults to profile's
                        namespace)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              name:
                description: Name is the human-readable name shown in NextDNS dashboard
                maxLength: 100
                minLength: 1
                type: string
              parentalControl:
                description: ParentalControl configures content filtering
                properties:
                  categories:
                    description: Categories specifies content categories to block
                    items:
                      description: CategoryEntry references a content category
                      properties:
                        active:
                          default: true
                          description: Active indicates if this category is blocked
                          type: boolean
                        id:
                          description: ID is the category identifier (e.g., "gambling",
                            "adult", "violence")
                          type: string
                      required:
                      - id
                      type: object
                    type: array
                  safeSearch:
                    default: false
                    description: SafeSearch enforces safe search on search engines
                    type: boolean
                  services:
                    description: Services specifies specific services to block
                    items:
                      description: ServiceEntry references a specific service
                      properties:
                        active:
                          default: true
                          description: Active indicates if this service is blocked
                          type: boolean
                        id:
                          description: ID is the service identifier (e.g., "tiktok",
                            "youtube", "facebook")
                          type: string
                      required:
                      - id
                      type: object
                    type: array
                  youtubeRestrictedMode:
                    default: false
                    description: YouTubeRestrictedMode enforces YouTube restricted
                      mode
                    type: boolean
                type: object
              privacy:
                description: Privacy configures tracker and ad blocking
                properties:
                  allowAffiliate:
                    default: false
                    description: AllowAffiliate allows affiliate & tracking links
                    type: boolean
                  blocklists:
                    description: Blocklists specifies which ad/tracker blocklists
                      to enable
                    items:
                      description: BlocklistEntry references a privacy blocklist
                      properties:
                        active:
                          default: true
                          description: Active indicates if this blocklist is enabled
                          type: boolean
                        id:
                          description: ID is the blocklist identifier (e.g., "nextdns-recommended",
                            "oisd")
                          type: string
                      required:
                      - id
                      type: object
                    type: array
                  disguisedTrackers:
                    default: true
                    description: DisguisedTrackers blocks trackers using CNAME cloaking
                    type: boolean
                  natives:
                    description: Natives specifies native tracking protection (per-vendor)
                    items:
                      description: NativeEntry configures native tracker blocking
                        for a vendor
                      properties:
                        active:
                          default: true
                          description: Active indicates if blocking is enabled for
                            this vendor
                          type: boolean
                        id:
                          description: ID is the vendor identifier (e.g., "apple",
                            "windows", "samsung")
                          type: string
                      required:
                      - id
                      type: object
                    type: array
                type: object
              profileID:
                description: |-
                  ProfileID optionally specifies an existing NextDNS profile to manage
                  If not set, a new profile will be created
                type: string
              rewrites:
                description: Rewrites specifies DNS rewrites
                items:
                  description: RewriteEntry defines a DNS rewrite rule
                  properties:
                    active:
                      default: true
                      description: Active indicates if this rewrite is enabled
                      type: boolean
                    from:
                      description: From is the source domain
                      type: string
                    to:
                      description: To is the target (IP or domain)
                      type: string
                  required:
                  - from
                  - to
                  type: object
                type: array
              security:
                description: Security configures threat protection settings
                properties:
                  aiThreatDetection:
                    default: true
                    description: AIThreatDetection enables AI-based threat detection
                    type: boolean
                  cryptojacking:
                    default: true
                    description: Cryptojacking blocks cryptomining scripts
                    type: boolean
                  csam:
                    default: true
                    description: CSAM blocks child sexual abuse material
                    type: boolean
                  ddns:
                    default: false
                    description: DDNS blocks dynamic DNS hostnames
                    type: boolean
                  dga:
                    default: true
                    description: DGA blocks algorithmically-generated domains
                    type: boolean
                  dnsRebinding:
                    default: true
                    description: DNSRebinding protects against DNS rebinding attacks
                    type: boolean
                  googleSafeBrowsing:
                    default: true
                    description: GoogleSafeBrowsing enables Google Safe Browsing protection
                    type: boolean
                  idnHomographs:
                    default: true
                    description: IDNHomographs blocks IDN homograph attacks
                    type: boolean
                  nrd:
                    default: false
                    description: NRD blocks newly registered domains
                    type: boolean
                  parking:
                    default: true
                    description: Parking blocks parked domains
                    type: boolean
                  threatIntelligenceFeeds:
                    description: ThreatIntelligenceFeeds specifies which threat feeds
                      to use
                    items:
                      type: string
                    type: array
                  typosquatting:
                    default: true
                    description: Typosquatting blocks typosquatting domains
                    type: boolean
                type: object
              settings:
                description: Settings configures logging, performance, and other options
                properties:
                  blockPage:
                    description: BlockPage configures the block page
                    properties:
                      enabled:
                        default: true
                        description: Enabled shows a block page instead of failing
                          silently
                        type: boolean
                    type: object
                  logs:
                    description: Logs configures query logging
                    properties:
                      enabled:
                        default: true
                        description: Enabled turns logging on/off
                        type: boolean
                      logClientsIPs:
                        default: false
                        description: LogClientsIPs logs client IP addresses
                        type: boolean
                      logDomains:
                        default: true
                        description: LogDomains logs queried domains
                        type: boolean
                      retention:
                        default: 7d
                        description: Retention specifies log retention period (1h,
                          6h, 1d, 7d, 30d, 90d, 1y, 2y)
                        type: string
                    type: object
                  performance:
                    description: Performance configures performance optimizations
                    properties:
                      cacheBoost:
                        default: true
                        description: CacheBoost enables extended caching
                        type: boolean
                      cnameFlattening:
                        default: true
                        description: CNAMEFlattening enables CNAME flattening
                        type: boolean
                      ecs:
                        default: true
                        description: ECS enables EDNS Client Subnet
                        type: boolean
                    type: object
                  web3:
                    default: false
                    description: Web3 enables Web3 domain resolution
                    type: boolean
                type: object
              tldListRefs:
                description: |-
                  TLDListRefs references NextDNSTLDList resources
                  TLDs from all referenced lists are merged
                items:
                  description: ListReference references a list CRD (allowlist, denylist,
                    or TLD list)
                  properties:
                    name:
                      description: Name of the list resource
                      type: string
                    namespace:
                      description: Namespace of the list resource (defaults to profile's
                        namespace)
                      type: string
                  required:
                  - name
                  type: object
                type: array
            required:
            - credentialsRef
            - name
            type: object
          status:
            description: NextDNSProfileStatus defines the observed state of NextDNSProfile
            properties:
              aggregatedCounts:
                description: AggregatedCounts tracks totals from all sources
                properties:
                  allowlistDomains:
                    description: AllowlistDomains is the total count of allowlisted
                      domains
                    type: integer
                  blockedTLDs:
                    description: BlockedTLDs is the total count of blocked TLDs
                    type: integer
                  denylistDomains:
                    description: DenylistDomains is the total count of denylisted
                      domains
                    type: integer
                type: object
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              configImportResourceVersion:
                description: |-
                  ConfigImportResourceVersion tracks the ResourceVersion of the imported ConfigMap
                  Used to detect changes and trigger re-import
                type: string
              fingerprint:
                description: Fingerprint is the DNS endpoint (e.g., "abc123.dns.nextdns.io")
                type: string
              lastSyncTime:
                description: LastSyncTime is the last time the profile was synced
                  with NextDNS
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration is the generation last processed by
                  the controller
                format: int64
                type: integer
              profileID:
                description: ProfileID is the NextDNS-assigned profile identifier
                type: string
              referencedResources:
                description: ReferencedResources tracks the status of referenced resources
                properties:
                  allowlists:
                    description: Allowlists lists the status of referenced allowlists
                    items:
                      description: ReferencedResourceStatus tracks the status of a
                        referenced resource
                      properties:
                        count:
                          description: Count of items (domains or TLDs)
                          type: integer
                        name:
                          description: Name of the resource
                          type: string
                        namespace:
                          description: Namespace of the resource
                          type: string
                        ready:
                          description: Ready indicates if the resource is ready
                          type: boolean
                      required:
                      - name
                      - namespace
                      - ready
                      type: object
                    type: array
                  denylists:
                    description: Denylists lists the status of referenced denylists
                    items:
                      description: ReferencedResourceStatus tracks the status of a
                        referenced resource
                      properties:
                        count:
                          description: Count of items (domains or TLDs)
                          type: integer
                        name:
                          description: Name of the resource
                          type: string
                        namespace:
                          description: Namespace of the resource
                          type: string
                        ready:
                          description: Ready indicates if the resource is ready
                          type: boolean
                      required:
                      - name
                      - namespace
                      - ready
                      type: object
                    type: array
                  tldLists:
                    description: TLDLists lists the status of referenced TLD lists
                    items:
                      description: ReferencedResourceStatus tracks the status of a
                        referenced resource
                      properties:
                        count:
                          description: Count of items (domains or TLDs)
                          type: integer
                        name:
                          description: Name of the resource
                          type: string
                        namespace:
                          description: Namespace of the resource
                          type: string
                        ready:
                          description: Ready indicates if the resource is ready
                          type: boolean
                      required:
                      - name
                      - namespace
                      - ready
                      type: object
                    type: array
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
